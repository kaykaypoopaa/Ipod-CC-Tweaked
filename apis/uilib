local uilib = {}

uilib.mon = term
uilib.buttonList = {}

function uilib.setup(target)
    uilib.mon = target
end

function uilib.addButton(x, y, width, height, label, color, action)
    table.insert(uilib.buttonList, {
        xMin = x, xMax = x + width - 1,
        yMin = y, yMax = y + height - 1,
        label = label,
        color = color,
        action = action
    })
end

function uilib.drawAll()
    uilib.mon.setBackgroundColor(colors.black)
    uilib.mon.clear()
    
    for _, b in ipairs(uilib.buttonList) do
        uilib.mon.setBackgroundColor(b.color)
        
        -- Draw the button shape
        for i = b.yMin, b.yMax do
            uilib.mon.setCursorPos(b.xMin, i)
            uilib.mon.write(string.rep(" ", b.xMax - b.xMin + 1))
        end
        
        -- FIX: Use yMin directly for 1-high buttons
        -- Only add +1 if the button is 3 or more blocks tall
        local textY = b.yMin
        if (b.yMax - b.yMin + 1) >= 3 then
            textY = b.yMin + 1
        end
        
        -- FIX: Start text at xMin for 5-wide buttons 
        -- (xMin + 1 would push a 5-letter word off the edge)
        uilib.mon.setCursorPos(b.xMin, textY)
        uilib.mon.setTextColor(colors.white)
        uilib.mon.write(b.label)
    end
end

function uilib.clickEvent(buttons)
    local event, side, x, y = os.pullEvent()
    
    if event == "monitor_touch" or event == "mouse_click" then
        for _, b in ipairs(buttons) do
            if x >= b.xMin and x <= b.xMax and y >= b.yMin and y <= b.yMax then
                b.action()
            end
        end
    end
end
return uilib
